{"uid":"c8cd355b9f1266be","name":"test_sort_video_infos[playlist]","fullName":"apps.youtu2douyin.test_youtu_video_tools#test_sort_video_infos","historyId":"b94db6d3d7bd22801fa6bbf56965091b","time":{"start":1716636534237,"stop":1716636534237,"duration":0},"status":"broken","statusMessage":"KeyError: 'channels'","statusTrace":"coll_handler = <class 'mypy.lib.youtube.core.base.YouTubePlaylist'>\n\n    @pytest.mark.parametrize(\n        'coll_handler',\n        [YouTubeChannel, YouTubePlaylist],\n        ids=['channel', 'playlist'])\n    def test_sort_video_infos(coll_handler):\n        record_api = JSONConfigHelper(\n            os.path.join(curr_path, 'config',\n                         coll_handler.record_filename))\n>       sort_video_infos(record_api)\n\nmypy/tests/apps/youtu2douyin/test_youtu_video_tools.py:30: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nrecord_api = <mypy.utils.json_config.JSONConfigHelper object at 0x7fc9710e6760>\n\n    def sort_video_infos(record_api):\n        \"\"\"\n        把视频记录信息按发布时间倒序排序\n        \"\"\"\n        LOG.info('开始对 %s 视频列表按照 publish_date 进行降序排序',\n                 record_api._json_filepath)\n    \n        def do_sort(data):\n            # 补充缺失的 publish_date、title、id 字段\n            for item in data:\n                y2_video = YouTube(item['url'])\n                if not item.get('publish_date'):\n                    item['publish_date'] = str(get_video_publish_date(item['url']))\n                if not item.get('title'):\n                    item['title'] = y2_video.title\n                if not item.get('id'):\n                    item['id'] = y2_video.video_id\n    \n            sorted_videos = sorted(\n                data, key=lambda x: x.get(\n                    \"publish_date\", Const.def_pub_datetime), reverse=True)\n            return sorted_videos\n    \n        upload_record = record_api.read()\n>       channels = upload_record['channels']\nE       KeyError: 'channels'\n\nmypy/apps/youtu2douyin/tools.py:64: KeyError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop_policy","time":{"start":1716627456536,"stop":1716627456536,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"shouldDisplayMessage":false,"stepsCount":0},{"name":"copy_config_to_dir","time":{"start":1716636533449,"stop":1716636533450,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"shouldDisplayMessage":false,"stepsCount":0}],"testStage":{"status":"broken","statusMessage":"KeyError: 'channels'","statusTrace":"coll_handler = <class 'mypy.lib.youtube.core.base.YouTubePlaylist'>\n\n    @pytest.mark.parametrize(\n        'coll_handler',\n        [YouTubeChannel, YouTubePlaylist],\n        ids=['channel', 'playlist'])\n    def test_sort_video_infos(coll_handler):\n        record_api = JSONConfigHelper(\n            os.path.join(curr_path, 'config',\n                         coll_handler.record_filename))\n>       sort_video_infos(record_api)\n\nmypy/tests/apps/youtu2douyin/test_youtu_video_tools.py:30: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nrecord_api = <mypy.utils.json_config.JSONConfigHelper object at 0x7fc9710e6760>\n\n    def sort_video_infos(record_api):\n        \"\"\"\n        把视频记录信息按发布时间倒序排序\n        \"\"\"\n        LOG.info('开始对 %s 视频列表按照 publish_date 进行降序排序',\n                 record_api._json_filepath)\n    \n        def do_sort(data):\n            # 补充缺失的 publish_date、title、id 字段\n            for item in data:\n                y2_video = YouTube(item['url'])\n                if not item.get('publish_date'):\n                    item['publish_date'] = str(get_video_publish_date(item['url']))\n                if not item.get('title'):\n                    item['title'] = y2_video.title\n                if not item.get('id'):\n                    item['id'] = y2_video.video_id\n    \n            sorted_videos = sorted(\n                data, key=lambda x: x.get(\n                    \"publish_date\", Const.def_pub_datetime), reverse=True)\n            return sorted_videos\n    \n        upload_record = record_api.read()\n>       channels = upload_record['channels']\nE       KeyError: 'channels'\n\nmypy/apps/youtu2douyin/tools.py:64: KeyError","steps":[],"attachments":[{"uid":"158a2b7a761f1d38","name":"log","source":"158a2b7a761f1d38.txt","type":"text/plain","size":218}],"parameters":[],"attachmentsCount":1,"hasContent":true,"attachmentStep":false,"shouldDisplayMessage":true,"stepsCount":0},"afterStages":[{"name":"copy_config_to_dir::finish_callback","time":{"start":1716636534243,"stop":1716636534243,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"shouldDisplayMessage":false,"stepsCount":0}],"labels":[{"name":"parentSuite","value":"apps.youtu2douyin"},{"name":"suite","value":"test_youtu_video_tools"},{"name":"host","value":"fv-az585-661"},{"name":"thread","value":"6665-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"apps.youtu2douyin.test_youtu_video_tools"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"coll_handler","value":"<class 'mypy.lib.youtube.core.base.YouTubePlaylist'>"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"c8cd355b9f1266be.json","parameterValues":["<class 'mypy.lib.youtube.core.base.YouTubePlaylist'>"]}