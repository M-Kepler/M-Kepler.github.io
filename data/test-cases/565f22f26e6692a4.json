{"uid":"565f22f26e6692a4","name":"test_launch_with_proxy","fullName":"lib.playwright.test_playwright_common#test_launch_with_proxy","historyId":"818be70b7c7d0017348a8c0347a9d538","time":{"start":1724808541497,"stop":1724808542515,"duration":1018},"description":"\n    使用代理 IP 运行浏览器\n    前提是安装了 3party/ 下的 proxy_pool\n    ","descriptionHtml":"<pre><code>使用代理 IP 运行浏览器\n前提是安装了 3party/ 下的 proxy_pool\n</code></pre>\n","status":"broken","statusMessage":"playwright._impl._errors.Error: APIRequestContext.get: Socket is closed\nCall log:\n→ GET https://ip.useragentinfo.com/json\n  -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\n  -   accept: */*\n  -   accept-encoding: gzip,deflate,br\n  - ← 400 Bad Request\n  -   server: nginx/1.12.1\n  -   date: Wed, 28 Aug 2024 01:30:08 GMT\n  -   content-type: text/html\n  -   content-length: 173\n  -   connection: close","statusTrace":"@pytest.mark.asyncio\n    async def test_launch_with_proxy():\n        \"\"\"\n        使用代理 IP 运行浏览器\n        前提是安装了 3party/ 下的 proxy_pool\n        \"\"\"\n        proxy = None\n        try:\n            proxy_ip = ProxyPoolHelper().get_region_proxy('湖南')\n            if proxy_ip:\n                proxy = {'server': proxy_ip}\n        except Exception as ex:\n            print('get proxy ip failed: %s', ex)\n    \n        async with async_playwright() as playwright:\n            async with PlaywrightCommon(proxy=proxy).launch_browser_mgr(playwright) as (_, _, page):\n>               resp = await page.request.get('https://ip.useragentinfo.com/json')\n\nmypy/tests/lib/playwright/test_playwright_common.py:55: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/async_api/_generated.py:17797: in get\n    await self._impl_obj.get(\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/_impl/_fetch.py:186: in get\n    return await self.fetch(\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/_impl/_fetch.py:312: in fetch\n    return await self._inner_fetch(\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/_impl/_fetch.py:403: in _inner_fetch\n    response = await self._channel.send(\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/_impl/_connection.py:59: in send\n    return await self._connection.wrap_api_call(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._connection.Connection object at 0x7f38342a0e20>\ncb = <function Channel.send.<locals>.<lambda> at 0x7f3834295790>\nis_internal = False\n\n    async def wrap_api_call(\n        self, cb: Callable[[], Any], is_internal: bool = False\n    ) -> Any:\n        if self._api_zone.get():\n            return await cb()\n        task = asyncio.current_task(self._loop)\n        st: List[inspect.FrameInfo] = getattr(task, \"__pw_stack__\", inspect.stack())\n        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal)\n        self._api_zone.set(parsed_st)\n        try:\n            return await cb()\n        except Exception as error:\n>           raise rewrite_error(error, f\"{parsed_st['apiName']}: {error}\") from None\nE           playwright._impl._errors.Error: APIRequestContext.get: Socket is closed\nE           Call log:\nE           → GET https://ip.useragentinfo.com/json\nE             -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\nE             -   accept: */*\nE             -   accept-encoding: gzip,deflate,br\nE             - ← 400 Bad Request\nE             -   server: nginx/1.12.1\nE             -   date: Wed, 28 Aug 2024 01:30:08 GMT\nE             -   content-type: text/html\nE             -   content-length: 173\nE             -   connection: close\n\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/_impl/_connection.py:514: Error","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop_policy","time":{"start":1724804131376,"stop":1724804131376,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"copy_config_to_dir","time":{"start":1724808541494,"stop":1724808541496,"duration":2},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop","time":{"start":1724808541496,"stop":1724808541496,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    使用代理 IP 运行浏览器\n    前提是安装了 3party/ 下的 proxy_pool\n    ","status":"broken","statusMessage":"playwright._impl._errors.Error: APIRequestContext.get: Socket is closed\nCall log:\n→ GET https://ip.useragentinfo.com/json\n  -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\n  -   accept: */*\n  -   accept-encoding: gzip,deflate,br\n  - ← 400 Bad Request\n  -   server: nginx/1.12.1\n  -   date: Wed, 28 Aug 2024 01:30:08 GMT\n  -   content-type: text/html\n  -   content-length: 173\n  -   connection: close","statusTrace":"@pytest.mark.asyncio\n    async def test_launch_with_proxy():\n        \"\"\"\n        使用代理 IP 运行浏览器\n        前提是安装了 3party/ 下的 proxy_pool\n        \"\"\"\n        proxy = None\n        try:\n            proxy_ip = ProxyPoolHelper().get_region_proxy('湖南')\n            if proxy_ip:\n                proxy = {'server': proxy_ip}\n        except Exception as ex:\n            print('get proxy ip failed: %s', ex)\n    \n        async with async_playwright() as playwright:\n            async with PlaywrightCommon(proxy=proxy).launch_browser_mgr(playwright) as (_, _, page):\n>               resp = await page.request.get('https://ip.useragentinfo.com/json')\n\nmypy/tests/lib/playwright/test_playwright_common.py:55: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/async_api/_generated.py:17797: in get\n    await self._impl_obj.get(\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/_impl/_fetch.py:186: in get\n    return await self.fetch(\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/_impl/_fetch.py:312: in fetch\n    return await self._inner_fetch(\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/_impl/_fetch.py:403: in _inner_fetch\n    response = await self._channel.send(\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/_impl/_connection.py:59: in send\n    return await self._connection.wrap_api_call(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._connection.Connection object at 0x7f38342a0e20>\ncb = <function Channel.send.<locals>.<lambda> at 0x7f3834295790>\nis_internal = False\n\n    async def wrap_api_call(\n        self, cb: Callable[[], Any], is_internal: bool = False\n    ) -> Any:\n        if self._api_zone.get():\n            return await cb()\n        task = asyncio.current_task(self._loop)\n        st: List[inspect.FrameInfo] = getattr(task, \"__pw_stack__\", inspect.stack())\n        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal)\n        self._api_zone.set(parsed_st)\n        try:\n            return await cb()\n        except Exception as error:\n>           raise rewrite_error(error, f\"{parsed_st['apiName']}: {error}\") from None\nE           playwright._impl._errors.Error: APIRequestContext.get: Socket is closed\nE           Call log:\nE           → GET https://ip.useragentinfo.com/json\nE             -   user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36\nE             -   accept: */*\nE             -   accept-encoding: gzip,deflate,br\nE             - ← 400 Bad Request\nE             -   server: nginx/1.12.1\nE             -   date: Wed, 28 Aug 2024 01:30:08 GMT\nE             -   content-type: text/html\nE             -   content-length: 173\nE             -   connection: close\n\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/playwright/_impl/_connection.py:514: Error","steps":[],"attachments":[{"uid":"3fd90e33656a4e19","name":"log","source":"3fd90e33656a4e19.txt","type":"text/plain","size":2720}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"event_loop::3","time":{"start":1724808542818,"stop":1724808542818,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_close_event_loop","time":{"start":1724808542818,"stop":1724808542818,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_restore_policy","time":{"start":1724808542818,"stop":1724808542818,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_provide_clean_event_loop","time":{"start":1724808542818,"stop":1724808542818,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"copy_config_to_dir::finish_callback","time":{"start":1724808546382,"stop":1724808546382,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"asyncio"},{"name":"parentSuite","value":"lib.playwright"},{"name":"suite","value":"test_playwright_common"},{"name":"host","value":"fv-az1535-547"},{"name":"thread","value":"8987-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"lib.playwright.test_playwright_common"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":["asyncio"]},"source":"565f22f26e6692a4.json","parameterValues":[]}