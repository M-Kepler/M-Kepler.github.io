{"uid":"a30f44f97028d356","name":"test_y2douyin_once[playlist]","fullName":"apps.youtu2douyin.test_youtu2douyin#test_y2douyin_once","historyId":"ce404f85784e602676f6c453ae493197","time":{"start":1716628698890,"stop":1716635049646,"duration":6350756},"status":"broken","statusMessage":"Exception: 任意一个平台都没发布成功: {'douyin': False, 'xiaohongshu': False}","statusTrace":"coll_handler = <class 'mypy.lib.youtube.core.base.YouTubePlaylist'>\n\n    @pytest.mark.parametrize('coll_handler',\n                             [YouTubePlaylist, YouTubeChannel],\n                             ids=['playlist', 'channel'])\n    def test_y2douyin_once(coll_handler):\n        upd_channel_to_latest(\n            record_file_dir=os.path.join(curr_dir, 'config'),\n            coll_handler=coll_handler)\n>       main(run_mod=Config.RUN_MOD_ONCE,\n             coll_handler=coll_handler,\n             work_path=curr_dir)\n\nmypy/tests/apps/youtu2douyin/test_youtu2douyin.py:56: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/apps/youtu2douyin/main.py:47: in main\n    api.do_once()\nmypy/apps/youtu2douyin/channel_loop.py:339: in do_once\n    self._download_video_and_publish(channel_videos=to_publish_videos,\nmypy/apps/youtu2douyin/channel_loop.py:182: in _download_video_and_publish\n    self._publish_video(every_video, video_fullpath, video_title, gen,\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mypy.apps.youtu2douyin.channel_loop.ChannelLoop object at 0x7fc971889a30>\nevery_video = {'id': 'QJUxSm_t42o', 'publish_date': '2024-05-07 00:00:00', 'published': [], 'title': 'Fluid and Electrolytes for Nursing Students - Comprehensive NCLEX Review', ...}\nvideo_fullpath = '/home/runner/work/github-runner/github-runner/mypy/tests/apps/youtu2douyin/_out/channel_PLQrdx7rRsKfV7rYMLXUs8L8IJAbDecClE/QJUxSm_t42o.mp4'\nvideo_title = '护理学生的流体和电解质'\ngen = <generator object DatetimeUtil.random_time_generator at 0x7fc971a9be40>\nfirst_video_published = [False], to_platforms = ['douyin', 'xiaohongshu']\nchannel_pub_cfg = <mypy.lib.playwright.publish_config.PublishConfig object at 0x7fc97104ea60>\nchannel_cfg = {'channel_name': 'Nursing Fundamentals', 'channel_url': 'https://www.youtube.com/playlist?list=PLQrdx7rRsKfV7rYMLXUs8L...escription': 'RN 注册护士考试资料 #HKRN #护士懂护士 #护士长 #注册护士 ', 'latest_publish_time': '0512-1005', 'publish_mod': 'timing'}, ...}\npublish_cfg = {'collection_name': 'HKRN/RN备考', 'description': 'RN 注册护士考试资料 #HKRN #护士懂护士 #护士长 #注册护士 ', 'latest_publish_time': '0512-1005', 'publish_mod': 'timing'}\nupload_record = {'channels': [{'channel_name': 'Nursing Fundamentals', 'channel_url': 'https://www.youtube.com/playlist?list=PLQrdx7rR...cription': 'RN 注册护士考试资料 #HKRN #护士懂护士 #护士长 #注册护士 ', 'latest_publish_time': '0512-1005', 'publish_mod': 'timing'}, ...}]}\n\n    def _publish_video(self, every_video, video_fullpath, video_title, gen,\n                       first_video_published, to_platforms, channel_pub_cfg,\n                       channel_cfg, publish_cfg, upload_record):\n        # 已发布的平台\n        published_platforms = every_video.get('published', [])\n    \n        # 待发布的平台\n        to_publish_platforms = []\n        for item in to_platforms:\n            if item in published_platforms:\n                LOG.info('《%s》已发布到 [%s] 平台',\n                         every_video.get('title'), item)\n                continue\n            to_publish_platforms.append(item)\n    \n        LOG.debug('----- 视频信息: %s', every_video)\n        publish_handler = PublishHandler(publish_files=video_fullpath,\n                                         work_path=self._work_path)\n    \n        # 第一个视频立即发布，后续的再定时发布\n        # XXX first_video_published 有问题，上层是值传递的，每次到这里这个值都是 False\n        # XXX 现在改成 list 让他支持引用传递\n        if Config.pulibsh_first_video_now and not first_video_published[0]:\n            LOG.info('立即发布监控到的第一条视频《%s》', video_title)\n            channel_pub_cfg.publish_mod = Const.PUBLISH_NOW\n            channel_pub_cfg.publish_time = datetime.now()\n            first_video_published[0] = True\n        else:\n            # 定时发布，获取下一个发布时间\n            channel_pub_cfg.publish_mod = channel_cfg.get(\n                'publish_mod', Const.PUBLISH_TIMING)\n            channel_pub_cfg.publish_time = next(gen)\n        # 设置发布标题（默认使用视频文件名作为标题）\n        channel_pub_cfg.title = video_title\n        channel_pub_cfg.to_platforms = to_publish_platforms\n        publish_result = publish_handler.publish(channel_pub_cfg)\n    \n        if not any(publish_result.values()):\n            err_msg = f'任意一个平台都没发布成功: {publish_result}'\n>           raise Exception(err_msg)\nE           Exception: 任意一个平台都没发布成功: {'douyin': False, 'xiaohongshu': False}\n\nmypy/apps/youtu2douyin/channel_loop.py:106: Exception","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop_policy","time":{"start":1716627456536,"stop":1716627456536,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"shouldDisplayMessage":false,"stepsCount":0},{"name":"copy_config_to_dir","time":{"start":1716628283738,"stop":1716628283740,"duration":2},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"shouldDisplayMessage":false,"stepsCount":0}],"testStage":{"status":"broken","statusMessage":"Exception: 任意一个平台都没发布成功: {'douyin': False, 'xiaohongshu': False}","statusTrace":"coll_handler = <class 'mypy.lib.youtube.core.base.YouTubePlaylist'>\n\n    @pytest.mark.parametrize('coll_handler',\n                             [YouTubePlaylist, YouTubeChannel],\n                             ids=['playlist', 'channel'])\n    def test_y2douyin_once(coll_handler):\n        upd_channel_to_latest(\n            record_file_dir=os.path.join(curr_dir, 'config'),\n            coll_handler=coll_handler)\n>       main(run_mod=Config.RUN_MOD_ONCE,\n             coll_handler=coll_handler,\n             work_path=curr_dir)\n\nmypy/tests/apps/youtu2douyin/test_youtu2douyin.py:56: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/apps/youtu2douyin/main.py:47: in main\n    api.do_once()\nmypy/apps/youtu2douyin/channel_loop.py:339: in do_once\n    self._download_video_and_publish(channel_videos=to_publish_videos,\nmypy/apps/youtu2douyin/channel_loop.py:182: in _download_video_and_publish\n    self._publish_video(every_video, video_fullpath, video_title, gen,\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mypy.apps.youtu2douyin.channel_loop.ChannelLoop object at 0x7fc971889a30>\nevery_video = {'id': 'QJUxSm_t42o', 'publish_date': '2024-05-07 00:00:00', 'published': [], 'title': 'Fluid and Electrolytes for Nursing Students - Comprehensive NCLEX Review', ...}\nvideo_fullpath = '/home/runner/work/github-runner/github-runner/mypy/tests/apps/youtu2douyin/_out/channel_PLQrdx7rRsKfV7rYMLXUs8L8IJAbDecClE/QJUxSm_t42o.mp4'\nvideo_title = '护理学生的流体和电解质'\ngen = <generator object DatetimeUtil.random_time_generator at 0x7fc971a9be40>\nfirst_video_published = [False], to_platforms = ['douyin', 'xiaohongshu']\nchannel_pub_cfg = <mypy.lib.playwright.publish_config.PublishConfig object at 0x7fc97104ea60>\nchannel_cfg = {'channel_name': 'Nursing Fundamentals', 'channel_url': 'https://www.youtube.com/playlist?list=PLQrdx7rRsKfV7rYMLXUs8L...escription': 'RN 注册护士考试资料 #HKRN #护士懂护士 #护士长 #注册护士 ', 'latest_publish_time': '0512-1005', 'publish_mod': 'timing'}, ...}\npublish_cfg = {'collection_name': 'HKRN/RN备考', 'description': 'RN 注册护士考试资料 #HKRN #护士懂护士 #护士长 #注册护士 ', 'latest_publish_time': '0512-1005', 'publish_mod': 'timing'}\nupload_record = {'channels': [{'channel_name': 'Nursing Fundamentals', 'channel_url': 'https://www.youtube.com/playlist?list=PLQrdx7rR...cription': 'RN 注册护士考试资料 #HKRN #护士懂护士 #护士长 #注册护士 ', 'latest_publish_time': '0512-1005', 'publish_mod': 'timing'}, ...}]}\n\n    def _publish_video(self, every_video, video_fullpath, video_title, gen,\n                       first_video_published, to_platforms, channel_pub_cfg,\n                       channel_cfg, publish_cfg, upload_record):\n        # 已发布的平台\n        published_platforms = every_video.get('published', [])\n    \n        # 待发布的平台\n        to_publish_platforms = []\n        for item in to_platforms:\n            if item in published_platforms:\n                LOG.info('《%s》已发布到 [%s] 平台',\n                         every_video.get('title'), item)\n                continue\n            to_publish_platforms.append(item)\n    \n        LOG.debug('----- 视频信息: %s', every_video)\n        publish_handler = PublishHandler(publish_files=video_fullpath,\n                                         work_path=self._work_path)\n    \n        # 第一个视频立即发布，后续的再定时发布\n        # XXX first_video_published 有问题，上层是值传递的，每次到这里这个值都是 False\n        # XXX 现在改成 list 让他支持引用传递\n        if Config.pulibsh_first_video_now and not first_video_published[0]:\n            LOG.info('立即发布监控到的第一条视频《%s》', video_title)\n            channel_pub_cfg.publish_mod = Const.PUBLISH_NOW\n            channel_pub_cfg.publish_time = datetime.now()\n            first_video_published[0] = True\n        else:\n            # 定时发布，获取下一个发布时间\n            channel_pub_cfg.publish_mod = channel_cfg.get(\n                'publish_mod', Const.PUBLISH_TIMING)\n            channel_pub_cfg.publish_time = next(gen)\n        # 设置发布标题（默认使用视频文件名作为标题）\n        channel_pub_cfg.title = video_title\n        channel_pub_cfg.to_platforms = to_publish_platforms\n        publish_result = publish_handler.publish(channel_pub_cfg)\n    \n        if not any(publish_result.values()):\n            err_msg = f'任意一个平台都没发布成功: {publish_result}'\n>           raise Exception(err_msg)\nE           Exception: 任意一个平台都没发布成功: {'douyin': False, 'xiaohongshu': False}\n\nmypy/apps/youtu2douyin/channel_loop.py:106: Exception","steps":[],"attachments":[{"uid":"ba8f87e3d4562b45","name":"log","source":"ba8f87e3d4562b45.txt","type":"text/plain","size":16912}],"parameters":[],"attachmentsCount":1,"hasContent":true,"attachmentStep":false,"shouldDisplayMessage":true,"stepsCount":0},"afterStages":[{"name":"copy_config_to_dir::finish_callback","time":{"start":1716636533445,"stop":1716636533445,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"hasContent":false,"attachmentStep":false,"shouldDisplayMessage":false,"stepsCount":0}],"labels":[{"name":"tag","value":"app"},{"name":"parentSuite","value":"apps.youtu2douyin"},{"name":"suite","value":"test_youtu2douyin"},{"name":"host","value":"fv-az585-661"},{"name":"thread","value":"6665-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"apps.youtu2douyin.test_youtu2douyin"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"coll_handler","value":"<class 'mypy.lib.youtube.core.base.YouTubePlaylist'>"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":["app"]},"source":"a30f44f97028d356.json","parameterValues":["<class 'mypy.lib.youtube.core.base.YouTubePlaylist'>"]}