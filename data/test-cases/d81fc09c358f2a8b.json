{"uid":"d81fc09c358f2a8b","name":"test_publish_app[\\u53d1\\u5e03\\u56fe\\u6587]","fullName":"lib.douyin.test_publish_app#test_publish_app","historyId":"a8025c4fd08e40a07bfb29f7a10828e4","time":{"start":1714016240537,"stop":1714016259393,"duration":18856},"status":"broken","statusMessage":"mypy.lib.playwright.exceptions.PublishFail","statusTrace":"self = <mypy.lib.douyin.image_publisher.DouyinImagesPublisher object at 0x7faa93172d30>\nplaywright = <playwright._impl._playwright.Playwright object at 0x7faa92fa4610>\n\n    async def publish_mission(self, playwright: Playwright):\n        \"\"\"\n        发布任务\n        \"\"\"\n        LOG.info(\"=\" * 60)\n        LOG.info('开始执行发布任务')\n        LOG.info(\"=\" * 60)\n    \n        # 浏览器上下文\n        browser, context, page = await PlaywrightCommon(\n            cookie_filepath=self._cookie_filepath,\n            headless=self._headless).launch_browser(playwright)\n        try:\n            # 判断登录状态\n            is_login = await self._check_login_status(page)\n            if not is_login:\n                return\n    \n            # 上传发布内容\n            await self.upload(page)\n    \n            # 填写信息\n>           await self.fill_publish_content(page)\n\nmypy/lib/playwright/publish_helper.py:131: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/lib/douyin/image_publisher.py:64: in fill_publish_content\n    await self.add_bgm(page)\nmypy/lib/douyin/image_publisher.py:52: in add_bgm\n    selected_card = random.choice(music_cards)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <random.Random object at 0x5561d6b60050>, seq = []\n\n    def choice(self, seq):\n        \"\"\"Choose a random element from a non-empty sequence.\"\"\"\n        try:\n            i = self._randbelow(len(seq))\n        except ValueError:\n>           raise IndexError('Cannot choose from an empty sequence') from None\nE           IndexError: Cannot choose from an empty sequence\n\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/random.py:290: IndexError\n\nThe above exception was the direct cause of the following exception:\n\npublish_file = '/home/runner/work/Python/Python/mypy/assets/media/ppt_slide_images'\n\n    @pytest.mark.parametrize('publish_file', [\n        Assets.ppt_slide_image_dir, Assets.video], ids=[\n            '发布图文', '发布视频'])\n    def test_publish_app(publish_file):\n>       DouyinPublishApp(curr_dir).publish(\n            upload_filepath=publish_file\n        )\n\nmypy/tests/lib/douyin/test_publish_app.py:23: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/lib/playwright/publish_app.py:192: in publish\n    asyncio.run(publish_helper.do_publish())\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/asyncio/runners.py:44: in run\n    return loop.run_until_complete(main)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/asyncio/base_events.py:616: in run_until_complete\n    return future.result()\nmypy/lib/playwright/publish_helper.py:147: in do_publish\n    async for attempt in AsyncRetrying(\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/tenacity/_asyncio.py:71: in __anext__\n    do = self.iter(retry_state=self._retry_state)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/tenacity/__init__.py:314: in iter\n    return fut.result()\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/concurrent/futures/_base.py:437: in result\n    return self.__get_result()\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/concurrent/futures/_base.py:389: in __get_result\n    raise self._exception\nmypy/lib/playwright/publish_helper.py:155: in do_publish\n    await self.publish_mission(playwright)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mypy.lib.douyin.image_publisher.DouyinImagesPublisher object at 0x7faa93172d30>\nplaywright = <playwright._impl._playwright.Playwright object at 0x7faa92fa4610>\n\n    async def publish_mission(self, playwright: Playwright):\n        \"\"\"\n        发布任务\n        \"\"\"\n        LOG.info(\"=\" * 60)\n        LOG.info('开始执行发布任务')\n        LOG.info(\"=\" * 60)\n    \n        # 浏览器上下文\n        browser, context, page = await PlaywrightCommon(\n            cookie_filepath=self._cookie_filepath,\n            headless=self._headless).launch_browser(playwright)\n        try:\n            # 判断登录状态\n            is_login = await self._check_login_status(page)\n            if not is_login:\n                return\n    \n            # 上传发布内容\n            await self.upload(page)\n    \n            # 填写信息\n            await self.fill_publish_content(page)\n    \n            # 触发发布并检查是否发布成功\n            await self.publish_trigger(page)\n        except Exception as ex:\n            LOG.exception('❌❌❌《%s》发布异常 ❌❌❌', self._publish_title)\n>           raise PublishFail() from ex\nE           mypy.lib.playwright.exceptions.PublishFail\n\nmypy/lib/playwright/publish_helper.py:137: PublishFail","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop_policy","time":{"start":1714014231622,"stop":1714014231622,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"broken","statusMessage":"mypy.lib.playwright.exceptions.PublishFail","statusTrace":"self = <mypy.lib.douyin.image_publisher.DouyinImagesPublisher object at 0x7faa93172d30>\nplaywright = <playwright._impl._playwright.Playwright object at 0x7faa92fa4610>\n\n    async def publish_mission(self, playwright: Playwright):\n        \"\"\"\n        发布任务\n        \"\"\"\n        LOG.info(\"=\" * 60)\n        LOG.info('开始执行发布任务')\n        LOG.info(\"=\" * 60)\n    \n        # 浏览器上下文\n        browser, context, page = await PlaywrightCommon(\n            cookie_filepath=self._cookie_filepath,\n            headless=self._headless).launch_browser(playwright)\n        try:\n            # 判断登录状态\n            is_login = await self._check_login_status(page)\n            if not is_login:\n                return\n    \n            # 上传发布内容\n            await self.upload(page)\n    \n            # 填写信息\n>           await self.fill_publish_content(page)\n\nmypy/lib/playwright/publish_helper.py:131: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/lib/douyin/image_publisher.py:64: in fill_publish_content\n    await self.add_bgm(page)\nmypy/lib/douyin/image_publisher.py:52: in add_bgm\n    selected_card = random.choice(music_cards)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <random.Random object at 0x5561d6b60050>, seq = []\n\n    def choice(self, seq):\n        \"\"\"Choose a random element from a non-empty sequence.\"\"\"\n        try:\n            i = self._randbelow(len(seq))\n        except ValueError:\n>           raise IndexError('Cannot choose from an empty sequence') from None\nE           IndexError: Cannot choose from an empty sequence\n\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/random.py:290: IndexError\n\nThe above exception was the direct cause of the following exception:\n\npublish_file = '/home/runner/work/Python/Python/mypy/assets/media/ppt_slide_images'\n\n    @pytest.mark.parametrize('publish_file', [\n        Assets.ppt_slide_image_dir, Assets.video], ids=[\n            '发布图文', '发布视频'])\n    def test_publish_app(publish_file):\n>       DouyinPublishApp(curr_dir).publish(\n            upload_filepath=publish_file\n        )\n\nmypy/tests/lib/douyin/test_publish_app.py:23: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/lib/playwright/publish_app.py:192: in publish\n    asyncio.run(publish_helper.do_publish())\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/asyncio/runners.py:44: in run\n    return loop.run_until_complete(main)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/asyncio/base_events.py:616: in run_until_complete\n    return future.result()\nmypy/lib/playwright/publish_helper.py:147: in do_publish\n    async for attempt in AsyncRetrying(\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/tenacity/_asyncio.py:71: in __anext__\n    do = self.iter(retry_state=self._retry_state)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/tenacity/__init__.py:314: in iter\n    return fut.result()\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/concurrent/futures/_base.py:437: in result\n    return self.__get_result()\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/concurrent/futures/_base.py:389: in __get_result\n    raise self._exception\nmypy/lib/playwright/publish_helper.py:155: in do_publish\n    await self.publish_mission(playwright)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mypy.lib.douyin.image_publisher.DouyinImagesPublisher object at 0x7faa93172d30>\nplaywright = <playwright._impl._playwright.Playwright object at 0x7faa92fa4610>\n\n    async def publish_mission(self, playwright: Playwright):\n        \"\"\"\n        发布任务\n        \"\"\"\n        LOG.info(\"=\" * 60)\n        LOG.info('开始执行发布任务')\n        LOG.info(\"=\" * 60)\n    \n        # 浏览器上下文\n        browser, context, page = await PlaywrightCommon(\n            cookie_filepath=self._cookie_filepath,\n            headless=self._headless).launch_browser(playwright)\n        try:\n            # 判断登录状态\n            is_login = await self._check_login_status(page)\n            if not is_login:\n                return\n    \n            # 上传发布内容\n            await self.upload(page)\n    \n            # 填写信息\n            await self.fill_publish_content(page)\n    \n            # 触发发布并检查是否发布成功\n            await self.publish_trigger(page)\n        except Exception as ex:\n            LOG.exception('❌❌❌《%s》发布异常 ❌❌❌', self._publish_title)\n>           raise PublishFail() from ex\nE           mypy.lib.playwright.exceptions.PublishFail\n\nmypy/lib/playwright/publish_helper.py:137: PublishFail","steps":[],"attachments":[{"uid":"4beb5acb437aacc9","name":"log","source":"4beb5acb437aacc9.txt","type":"text/plain","size":2032}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"tag","value":"douyin"},{"name":"parentSuite","value":"lib.douyin"},{"name":"suite","value":"test_publish_app"},{"name":"host","value":"fv-az905-603"},{"name":"thread","value":"6448-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"lib.douyin.test_publish_app"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"publish_file","value":"'/home/runner/work/Python/Python/mypy/assets/media/ppt_slide_images'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":["douyin"]},"source":"d81fc09c358f2a8b.json","parameterValues":["'/home/runner/work/Python/Python/mypy/assets/media/ppt_slide_images'"]}