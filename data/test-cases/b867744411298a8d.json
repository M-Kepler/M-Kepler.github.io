{"uid":"b867744411298a8d","name":"test_random_music","fullName":"lib.music.test_music#test_random_music","historyId":"b24072e5b81c4559c859f23e6bdf58cd","time":{"start":1725621021543,"stop":1725621099264,"duration":77721},"description":"\n    测试从音乐文件夹下随机选择一首歌曲\n    ","descriptionHtml":"<pre><code>测试从音乐文件夹下随机选择一首歌曲\n</code></pre>\n","status":"broken","statusMessage":"FileNotFoundError: [Errno 2] No such file or directory: '/home/runner/work/github-runner/github-runner/mypy/tests/lib/music/_out/test_music/_out/music/okzyPhCF4MXP4fyWchENhQqHT8wjAsQV5yIKBA' -> '/home/runner/work/github-runner/github-runner/mypy/tests/lib/music/_out/test_music/_out/music/家和万事兴（剪辑版5）.m4a'","statusTrace":"test_output_dir = '/home/runner/work/github-runner/github-runner/mypy/tests/lib/music/_out/test_music'\n\n    def test_random_music(test_output_dir):\n        \"\"\"\n        测试从音乐文件夹下随机选择一首歌曲\n        \"\"\"\n>       music = MusicHelper.random_music(music_dir=test_output_dir)\n\nmypy/tests/lib/music/test_music.py:18: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/lib/music/music.py:27: in random_music\n    DouyinMusic(music_download_dir).download()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mypy.lib.douyin.douyin_music.DouyinMusic object at 0x7fa1c91de550>\n\n    def download(self):\n        \"\"\"\n        下载抖音热门歌曲\n        \"\"\"\n        music_list = self._get_hot_music_info()\n    \n        music_urls = []\n        dl_filepath2name = {}\n        # 获取下载的歌曲信息和下载链接\n        for item in music_list:\n            music_info = item['music_info']\n            uri = music_info['play_url']['uri']\n            # 音乐信息中的 ID /path/to/save/[music_id]\n            music_id = os.path.join(\n                self._download_dir, os.path.basename(uri))\n            # 音乐信息中的 ID 对应的歌曲名称 /path/to/save/[music_name]\n            music_name = os.path.join(\n                self._download_dir, music_info['title'] + DOWNLOAD_MUSIC_EXT)\n            if os.path.exists(music_name):\n                LOG.warning('文件 %s 已经存在', music_name)\n                continue\n            # 收集下载链接\n            music_urls.append(uri)\n            dl_filepath2name[music_id] = music_name\n    \n        if FileUtil.is_all_path_exists(dl_filepath2name.values()):\n            LOG.warning('需下载的文件已经全都存在')\n            return\n    \n        api = Downloader(urls=music_urls,\n                         per_producer_mission_cnt=20,\n                         download_dir=self._download_dir,\n                         consumer_count=20)\n        api.do_download()\n    \n        # 批量重命名\n        for dl_filepath, music_name in dl_filepath2name.items():\n            # 重命名文件\n            new_path = os.path.join(self._download_dir, music_name)\n            if os.path.exists(new_path):\n                continue\n>           os.rename(dl_filepath, new_path)\nE           FileNotFoundError: [Errno 2] No such file or directory: '/home/runner/work/github-runner/github-runner/mypy/tests/lib/music/_out/test_music/_out/music/okzyPhCF4MXP4fyWchENhQqHT8wjAsQV5yIKBA' -> '/home/runner/work/github-runner/github-runner/mypy/tests/lib/music/_out/test_music/_out/music/家和万事兴（剪辑版5）.m4a'\n\nmypy/lib/douyin/douyin_music.py:77: FileNotFoundError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop_policy","time":{"start":1725615796842,"stop":1725615796842,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"copy_config_to_dir","time":{"start":1725621021541,"stop":1725621021542,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_output_dir","time":{"start":1725621021542,"stop":1725621021543,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    测试从音乐文件夹下随机选择一首歌曲\n    ","status":"broken","statusMessage":"FileNotFoundError: [Errno 2] No such file or directory: '/home/runner/work/github-runner/github-runner/mypy/tests/lib/music/_out/test_music/_out/music/okzyPhCF4MXP4fyWchENhQqHT8wjAsQV5yIKBA' -> '/home/runner/work/github-runner/github-runner/mypy/tests/lib/music/_out/test_music/_out/music/家和万事兴（剪辑版5）.m4a'","statusTrace":"test_output_dir = '/home/runner/work/github-runner/github-runner/mypy/tests/lib/music/_out/test_music'\n\n    def test_random_music(test_output_dir):\n        \"\"\"\n        测试从音乐文件夹下随机选择一首歌曲\n        \"\"\"\n>       music = MusicHelper.random_music(music_dir=test_output_dir)\n\nmypy/tests/lib/music/test_music.py:18: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/lib/music/music.py:27: in random_music\n    DouyinMusic(music_download_dir).download()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mypy.lib.douyin.douyin_music.DouyinMusic object at 0x7fa1c91de550>\n\n    def download(self):\n        \"\"\"\n        下载抖音热门歌曲\n        \"\"\"\n        music_list = self._get_hot_music_info()\n    \n        music_urls = []\n        dl_filepath2name = {}\n        # 获取下载的歌曲信息和下载链接\n        for item in music_list:\n            music_info = item['music_info']\n            uri = music_info['play_url']['uri']\n            # 音乐信息中的 ID /path/to/save/[music_id]\n            music_id = os.path.join(\n                self._download_dir, os.path.basename(uri))\n            # 音乐信息中的 ID 对应的歌曲名称 /path/to/save/[music_name]\n            music_name = os.path.join(\n                self._download_dir, music_info['title'] + DOWNLOAD_MUSIC_EXT)\n            if os.path.exists(music_name):\n                LOG.warning('文件 %s 已经存在', music_name)\n                continue\n            # 收集下载链接\n            music_urls.append(uri)\n            dl_filepath2name[music_id] = music_name\n    \n        if FileUtil.is_all_path_exists(dl_filepath2name.values()):\n            LOG.warning('需下载的文件已经全都存在')\n            return\n    \n        api = Downloader(urls=music_urls,\n                         per_producer_mission_cnt=20,\n                         download_dir=self._download_dir,\n                         consumer_count=20)\n        api.do_download()\n    \n        # 批量重命名\n        for dl_filepath, music_name in dl_filepath2name.items():\n            # 重命名文件\n            new_path = os.path.join(self._download_dir, music_name)\n            if os.path.exists(new_path):\n                continue\n>           os.rename(dl_filepath, new_path)\nE           FileNotFoundError: [Errno 2] No such file or directory: '/home/runner/work/github-runner/github-runner/mypy/tests/lib/music/_out/test_music/_out/music/okzyPhCF4MXP4fyWchENhQqHT8wjAsQV5yIKBA' -> '/home/runner/work/github-runner/github-runner/mypy/tests/lib/music/_out/test_music/_out/music/家和万事兴（剪辑版5）.m4a'\n\nmypy/lib/douyin/douyin_music.py:77: FileNotFoundError","steps":[],"attachments":[{"uid":"ba7e420135e2bfa9","name":"log","source":"ba7e420135e2bfa9.txt","type":"text/plain","size":1367}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"copy_config_to_dir::finish_callback","time":{"start":1725621099275,"stop":1725621099276,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_output_dir::0","time":{"start":1725621099276,"stop":1725621099276,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"audio"},{"name":"parentSuite","value":"lib.music"},{"name":"suite","value":"test_music"},{"name":"host","value":"fv-az651-110"},{"name":"thread","value":"8815-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"lib.music.test_music"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":["audio"]},"source":"b867744411298a8d.json","parameterValues":[]}