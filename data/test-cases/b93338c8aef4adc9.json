{"uid":"b93338c8aef4adc9","name":"test_douyin2douyin","fullName":"apps.douyin2douyin.test_douyin2douyin#test_douyin2douyin","historyId":"9c3088b85c6e06877d27a19ba286db3e","time":{"start":1710166746170,"stop":1710166748131,"duration":1961},"status":"skipped","statusMessage":"XFAIL API 有限制，可能会获取 cookie 失败\n\nKeyError: 'data'","statusTrace":"test_output_dir = '/home/runner/work/Python/Python/mypy/tests/apps/douyin2douyin/_out/test_douyin2douyin'\n\n    @pytest.mark.app\n    @pytest.mark.douyin\n    @pytest.mark.xfail(reason='API 有限制，可能会获取 cookie 失败')\n    def test_douyin2douyin(test_output_dir):\n>       video_path = main(curr_path)\n\nmypy/tests/apps/douyin2douyin/test_douyin2douyin.py:15: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/apps/douyin2douyin/main.py:12: in main\n    video_id, video_path = HotDouyinHandler(work_path).handle()\nmypy/lib/douyin/get_hot_video.py:291: in handle\n    raise ex\nmypy/lib/douyin/get_hot_video.py:281: in handle\n    video_url = self._get_douyin_hot_music_video()\nmypy/lib/douyin/get_hot_video.py:197: in _get_douyin_hot_music_video\n    jd, res = self._get_douyin_music_video()\nmypy/lib/douyin/get_hot_video.py:153: in _get_douyin_music_video\n    cookie_str=self._get_web_cookie())\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mypy.lib.douyin.get_hot_video.HotDouyinHandler object at 0x7f6afe99f970>\n\n    def _get_web_cookie(self):\n        \"\"\"\n        获取 cookie\n        \"\"\"\n    \n        header = {\n            'cid': spider_cfg.cid,\n            'timestamp': FileUtil.get_timestamp(),\n            'user-agent': 'okhttp/3.10.0.12'}\n        resp = None\n        try:\n            resp = requests.post(url=spider_cfg.get_cookie_url,\n                                 headers=header,\n                                 data={'sign': self._set_sign()},\n                                 timeout=spider_cfg.http_timeout).json()\n>           return resp['data'][0]['cookie']\nE           KeyError: 'data'\n\nmypy/lib/douyin/get_hot_video.py:86: KeyError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"test_output_dir","time":{"start":1710166746168,"stop":1710166746169,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"skipped","statusMessage":"XFAIL API 有限制，可能会获取 cookie 失败\n\nKeyError: 'data'","statusTrace":"test_output_dir = '/home/runner/work/Python/Python/mypy/tests/apps/douyin2douyin/_out/test_douyin2douyin'\n\n    @pytest.mark.app\n    @pytest.mark.douyin\n    @pytest.mark.xfail(reason='API 有限制，可能会获取 cookie 失败')\n    def test_douyin2douyin(test_output_dir):\n>       video_path = main(curr_path)\n\nmypy/tests/apps/douyin2douyin/test_douyin2douyin.py:15: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/apps/douyin2douyin/main.py:12: in main\n    video_id, video_path = HotDouyinHandler(work_path).handle()\nmypy/lib/douyin/get_hot_video.py:291: in handle\n    raise ex\nmypy/lib/douyin/get_hot_video.py:281: in handle\n    video_url = self._get_douyin_hot_music_video()\nmypy/lib/douyin/get_hot_video.py:197: in _get_douyin_hot_music_video\n    jd, res = self._get_douyin_music_video()\nmypy/lib/douyin/get_hot_video.py:153: in _get_douyin_music_video\n    cookie_str=self._get_web_cookie())\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mypy.lib.douyin.get_hot_video.HotDouyinHandler object at 0x7f6afe99f970>\n\n    def _get_web_cookie(self):\n        \"\"\"\n        获取 cookie\n        \"\"\"\n    \n        header = {\n            'cid': spider_cfg.cid,\n            'timestamp': FileUtil.get_timestamp(),\n            'user-agent': 'okhttp/3.10.0.12'}\n        resp = None\n        try:\n            resp = requests.post(url=spider_cfg.get_cookie_url,\n                                 headers=header,\n                                 data={'sign': self._set_sign()},\n                                 timeout=spider_cfg.http_timeout).json()\n>           return resp['data'][0]['cookie']\nE           KeyError: 'data'\n\nmypy/lib/douyin/get_hot_video.py:86: KeyError","steps":[],"attachments":[{"uid":"5d15bfd8a32b2a32","name":"log","source":"5d15bfd8a32b2a32.txt","type":"text/plain","size":1328}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"test_output_dir::0","time":{"start":1710166748272,"stop":1710166748272,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"@pytest.mark.xfail(reason='API 有限制，可能会获取 cookie 失败')"},{"name":"tag","value":"douyin"},{"name":"tag","value":"app"},{"name":"parentSuite","value":"apps.douyin2douyin"},{"name":"suite","value":"test_douyin2douyin"},{"name":"host","value":"fv-az914-153"},{"name":"thread","value":"7320-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"apps.douyin2douyin.test_douyin2douyin"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"tags":["app","@pytest.mark.xfail(reason='API 有限制，可能会获取 cookie 失败')","douyin"]},"source":"b93338c8aef4adc9.json","parameterValues":[]}