{"uid":"998049d04e087582","name":"test_douyin_publish_app[xiaohongshu_ppt_video]","fullName":"lib.douyin.test_douyin_publish_app#test_douyin_publish_app","historyId":"d89a04a3115a6cc2a2ff4d1d5d84ebfd","time":{"start":1724423064295,"stop":1724423064298,"duration":3},"description":"\n    测试图文发布、横屏视频、竖屏视频发布\n    ","descriptionHtml":"<pre><code>测试图文发布、横屏视频、竖屏视频发布\n</code></pre>\n","status":"broken","statusMessage":"Exception: 在 /home/runner/work/github-runner/github-runner/mypy/tests/lib/douyin/config/cookie/xiaohongshu 下未找到 cookie","statusTrace":"test_output_dir = '/home/runner/work/github-runner/github-runner/mypy/tests/lib/douyin/_out/test_douyin_publish_app'\npublish_app = <class 'mypy.lib.xiaohongshu.publish_app.XiaohongshuPublishApp'>\npublish_file = '/home/runner/work/github-runner/github-runner/mypy/assets/media/ppt/ppt_video_maked.mp4'\n\n    @pytest.mark.parametrize(\n        'publish_app, publish_file',\n        [\n            (DouyinPublishApp, Assets.ppt_slide_image_dir),\n            (DouyinPublishApp, Assets.vertical_video),\n            (DouyinPublishApp, Assets.ppt_video_maked),\n    \n            (WechatPublishApp, Assets.ppt_slide_image_dir),\n            (WechatPublishApp, Assets.vertical_video),\n            (WechatPublishApp, Assets.ppt_video_maked),\n    \n            (XiaohongshuPublishApp, Assets.ppt_slide_image_dir),\n            (XiaohongshuPublishApp, Assets.vertical_video),\n            (XiaohongshuPublishApp, Assets.ppt_video_maked)\n        ],\n        ids=['douyin_image_article', 'douyin_vertical_video', 'douyin_ppt_video',\n             'wechat_image_article', 'wechat_vertical_video', 'wechat_ppt_video',\n             'xiaohongshu_image_article', 'xiaohongshu_vertical_video', 'xiaohongshu_ppt_video'])\n    def test_douyin_publish_app(test_output_dir, publish_app, publish_file):\n        \"\"\"\n        测试图文发布、横屏视频、竖屏视频发布\n        \"\"\"\n        media_type = Const.MEDIA_TYPE_VIDEO\n        if os.path.isdir(publish_file):\n            media_type = Const.MEDIA_TYPE_IMG_ARTICLE\n    \n        work_dir = os.path.join(test_output_dir, curr_func_name())\n        source_config_dir = os.path.join(curr_dir, 'config')\n        with FileUtil.copy_file_context([source_config_dir], work_dir):\n            config_path = os.path.join(\n                work_dir, 'config', 'config.ini')\n            set_config(config_path=config_path,\n                       settings={\n                           ('publish', 'publish_account'): Account.TEST,\n                           ('publish', 'media_type'): media_type\n                       })\n>           publish_app(curr_dir).publish(upload_filepath=publish_file)\n\nmypy/tests/lib/douyin/test_douyin_publish_app.py:99: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/lib/playwright/core/publish_app.py:157: in publish\n    asyncio.run(\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/asyncio/runners.py:44: in run\n    return loop.run_until_complete(main)\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/asyncio/base_events.py:647: in run_until_complete\n    return future.result()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mypy.lib.xiaohongshu.publish_app.XiaohongshuPublishApp object at 0x7fb9a4d7a3a0>\nupload_filepath = '/home/runner/work/github-runner/github-runner/mypy/assets/media/ppt/ppt_video_maked.mp4'\npub_cfg = None, video_title = None, manual = False\n\n    async def async_publish(self, upload_filepath: str, pub_cfg: PublishConfig = None,\n                            video_title: str = None, manual: bool = False):\n        \"\"\"\n        处理发布过程\n    \n        :param upload_filepath: 发布的内容路径\n        :param pub_cfg: 发布配置\n                        如果为空则会读取 {self._work_path}/config/config.ini 下的发布配置\n        :param video_title: 标题，默认视频文件名称作为标题\n        :param manual: 是否是 console 提示的形式，提示手动输入发布配置\n        \"\"\"\n    \n        cookie_list = FileUtil.list_files_by_ext(\n            find_path=self._cookie_dir, find_exts=[\".json\"])\n        if not cookie_list:\n            self._logger.warning('在 %s 下未找到 cookie', self._cookie_dir)\n>           raise Exception(f'在 {self._cookie_dir} 下未找到 cookie')\nE           Exception: 在 /home/runner/work/github-runner/github-runner/mypy/tests/lib/douyin/config/cookie/xiaohongshu 下未找到 cookie\n\nmypy/lib/playwright/core/publish_app.py:117: Exception","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"event_loop_policy","time":{"start":1724418389991,"stop":1724418389991,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"copy_config_to_dir","time":{"start":1724422243377,"stop":1724422243378,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_output_dir","time":{"start":1724422243378,"stop":1724422243379,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    测试图文发布、横屏视频、竖屏视频发布\n    ","status":"broken","statusMessage":"Exception: 在 /home/runner/work/github-runner/github-runner/mypy/tests/lib/douyin/config/cookie/xiaohongshu 下未找到 cookie","statusTrace":"test_output_dir = '/home/runner/work/github-runner/github-runner/mypy/tests/lib/douyin/_out/test_douyin_publish_app'\npublish_app = <class 'mypy.lib.xiaohongshu.publish_app.XiaohongshuPublishApp'>\npublish_file = '/home/runner/work/github-runner/github-runner/mypy/assets/media/ppt/ppt_video_maked.mp4'\n\n    @pytest.mark.parametrize(\n        'publish_app, publish_file',\n        [\n            (DouyinPublishApp, Assets.ppt_slide_image_dir),\n            (DouyinPublishApp, Assets.vertical_video),\n            (DouyinPublishApp, Assets.ppt_video_maked),\n    \n            (WechatPublishApp, Assets.ppt_slide_image_dir),\n            (WechatPublishApp, Assets.vertical_video),\n            (WechatPublishApp, Assets.ppt_video_maked),\n    \n            (XiaohongshuPublishApp, Assets.ppt_slide_image_dir),\n            (XiaohongshuPublishApp, Assets.vertical_video),\n            (XiaohongshuPublishApp, Assets.ppt_video_maked)\n        ],\n        ids=['douyin_image_article', 'douyin_vertical_video', 'douyin_ppt_video',\n             'wechat_image_article', 'wechat_vertical_video', 'wechat_ppt_video',\n             'xiaohongshu_image_article', 'xiaohongshu_vertical_video', 'xiaohongshu_ppt_video'])\n    def test_douyin_publish_app(test_output_dir, publish_app, publish_file):\n        \"\"\"\n        测试图文发布、横屏视频、竖屏视频发布\n        \"\"\"\n        media_type = Const.MEDIA_TYPE_VIDEO\n        if os.path.isdir(publish_file):\n            media_type = Const.MEDIA_TYPE_IMG_ARTICLE\n    \n        work_dir = os.path.join(test_output_dir, curr_func_name())\n        source_config_dir = os.path.join(curr_dir, 'config')\n        with FileUtil.copy_file_context([source_config_dir], work_dir):\n            config_path = os.path.join(\n                work_dir, 'config', 'config.ini')\n            set_config(config_path=config_path,\n                       settings={\n                           ('publish', 'publish_account'): Account.TEST,\n                           ('publish', 'media_type'): media_type\n                       })\n>           publish_app(curr_dir).publish(upload_filepath=publish_file)\n\nmypy/tests/lib/douyin/test_douyin_publish_app.py:99: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmypy/lib/playwright/core/publish_app.py:157: in publish\n    asyncio.run(\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/asyncio/runners.py:44: in run\n    return loop.run_until_complete(main)\n/opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/asyncio/base_events.py:647: in run_until_complete\n    return future.result()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mypy.lib.xiaohongshu.publish_app.XiaohongshuPublishApp object at 0x7fb9a4d7a3a0>\nupload_filepath = '/home/runner/work/github-runner/github-runner/mypy/assets/media/ppt/ppt_video_maked.mp4'\npub_cfg = None, video_title = None, manual = False\n\n    async def async_publish(self, upload_filepath: str, pub_cfg: PublishConfig = None,\n                            video_title: str = None, manual: bool = False):\n        \"\"\"\n        处理发布过程\n    \n        :param upload_filepath: 发布的内容路径\n        :param pub_cfg: 发布配置\n                        如果为空则会读取 {self._work_path}/config/config.ini 下的发布配置\n        :param video_title: 标题，默认视频文件名称作为标题\n        :param manual: 是否是 console 提示的形式，提示手动输入发布配置\n        \"\"\"\n    \n        cookie_list = FileUtil.list_files_by_ext(\n            find_path=self._cookie_dir, find_exts=[\".json\"])\n        if not cookie_list:\n            self._logger.warning('在 %s 下未找到 cookie', self._cookie_dir)\n>           raise Exception(f'在 {self._cookie_dir} 下未找到 cookie')\nE           Exception: 在 /home/runner/work/github-runner/github-runner/mypy/tests/lib/douyin/config/cookie/xiaohongshu 下未找到 cookie\n\nmypy/lib/playwright/core/publish_app.py:117: Exception","steps":[],"attachments":[{"uid":"df0084f4c4783c26","name":"log","source":"df0084f4c4783c26.txt","type":"text/plain","size":668}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"test_output_dir::0","time":{"start":1724423064342,"stop":1724423064342,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"copy_config_to_dir::finish_callback","time":{"start":1724423064342,"stop":1724423064343,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"douyin"},{"name":"parentSuite","value":"lib.douyin"},{"name":"suite","value":"test_douyin_publish_app"},{"name":"host","value":"fv-az1016-466"},{"name":"thread","value":"8923-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"lib.douyin.test_douyin_publish_app"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"publish_app","value":"<class 'mypy.lib.xiaohongshu.publish_app.XiaohongshuPublishApp'>"},{"name":"publish_file","value":"'/home/runner/work/github-runner/github-runner/mypy/assets/media/ppt/ppt_video_maked.mp4'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"tags":["douyin"]},"source":"998049d04e087582.json","parameterValues":["<class 'mypy.lib.xiaohongshu.publish_app.XiaohongshuPublishApp'>","'/home/runner/work/github-runner/github-runner/mypy/assets/media/ppt/ppt_video_maked.mp4'"]}