- [参考资料](#参考资料)
- [`ARP`](#arp)
  - [工作原理](#工作原理)
  - [形象化理解](#形象化理解)
  - [`Arp` 欺骗](#arp-欺骗)

## 参考资料

## `ARP`

> ARP 是地址转换协议（`Address Resolution Protocol`）的英文缩写，它是一个`链路层协议`，工作在 OSI 模型的第二层

### 工作原理

- 首先，每个主机都会在自己的 ARP 缓冲区中建立一个 ARP 列表，以表示 IP 地址和 MAC 地址之间的对应关系。

- 当源主机要发送数据时，首先`检查ARP缓冲列表`中是否有对应 IP 地址的目的主机的 MAC 地址，如果有，则直接发送数据; 如果没有，就向本网段(**局域网**)的所有主机`发送ARP数据包`，包括的内容有：源主机 IP 地址，源主机 MAC 地址，目的主机的 IP 地址。

- 当本网络的所有主机收到该 ARP 数据包时，首先检查数据包中的目的 IP 地址是否是自己的 IP 地址，如果不是，则忽略该数据包; 如果是，则`更新自身Arp缓存`首先从数据包中取出源主机的 IP 和 MAC 地址写入到 ARP 列表中; 如果已经存在，则覆盖，然后将自己的`MAC地址写入ARP响应包`中，告诉源主机自己是它想要找的 MAC 地址。

- 源主机收到 ARP 响应包后, `更新自身arp缓冲`将目的主机的 IP 和 MAC 地址写入 ARP 列表，并利用此信息发送数据; 如果源主机一直没有收到 ARP 响应数据包，表示 ARP 查询失败。

### 形象化理解

> A 表示 IP 地址, 电话号码表示 Mac 地址

- 在公园里, A 想打电话给 B, 翻看通讯录（`检查arp缓存`）没发现 B 的号码; (如果有就直接打电话过去了)

- 于是 A 在公园大喊一声（`arp请求(广播)`）:我是 A ，我号码是 123，B 你的电话号码是什么

- 公园里其他人听到问的不是自己, 就没管它； B 看到有人问自己号码, 于是就把对方存到通讯录（`更新arp缓存`）, 然后打电话告诉对方:我就是 B（`arp响应(单播)`）

- A 看到接到电话说他就是 B，于是就记录到自己通讯录中, 下次想找 B 直接从通讯录打电话过去

### `Arp` 欺骗

- 有两个问题

  - A 不管谁打电话来说他是 B, 他都认为是真的 B 打过来的

  - B 也不管谁说 A 的号码是什么, 他都认为这就是真的 A 的号码

- 假设有一个不规矩的 C,电话号码是 234

  - A 在公园喊：我是 A, 我号码是 123, B 你的电话是多少?

    `单向欺骗` 这时候 C 就打电话给 A, 说我就是 B, 然后 A 就把 234 保存为 B 的号码, 这样以后 A 要联系 B 都会去通讯录找

    所以 C 就完全知道 A 想告诉 B 的内容了

  - `双向欺骗` C 再可以假冒 A, A 虽然在公园喊谁是 B 的时候, C 也在喊:我是 A, 我的号码是 234, B 你的电话是多少?

    这时候 B 会把 234 当作 A 的电话号码记到通讯录,.

    之后, A 要跟 B 交流会打 234 这个号码, C 看到 A 发给 B 的内容后, 转手发给 B, B 看到是 234 发过来的, 就认为是 A 的内容, 然后继续通信下去...
