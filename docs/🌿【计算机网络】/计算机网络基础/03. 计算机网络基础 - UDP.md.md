- [`UDP` 报文](#udp-报文)
  - [`UDP` 报文解析](#udp-报文解析)
  - [★ `TCP 和 UDP`的区别](#-tcp-和-udp的区别)
  - [怎么理解 `面向报文`、`面向字节流`](#怎么理解-面向报文面向字节流)
  - [UDP 如何实现可靠性传输](#udp-如何实现可靠性传输)
- [参考资料](#参考资料)

# `UDP` 报文

## `UDP` 报文解析

![alt](http://c.biancheng.net/uploads/allimg/191111/6-1911111249535K.gif)

- UDP 头部一共占据 `8` 个字节（TCP 头部 20 个字节）

- 源/目的端口占据 `16` 位（所以端口最大为 `2^16 - 1 = 65535`）

- `长度`

  表示 `UDP` 数据报的长度，包含报文头和数据部分（感觉这就是为什么 UDP 不会有粘包问题的原因）

- `校验值`

  不要以为 UDP 没有校验和哦

- UDP 是面向报文的。发送方的 UDP 对应用程序交下来的报文，在添加首部后就向下交付给 IP 层；`既不拆分，也不合并，而是保留这些报文的边界`，因此，应用程序需要选择合适的报文大小

## ★ `TCP 和 UDP`的区别

> `TCP` 提供的是 `【面向连接的可靠的】`传输服务，在传输数据之前会先发起三次握手建立连接，而且有 `【流量控制、拥塞控制】`，有 `【面向连接、确认机制、超时重传、校验和】`等机制来保证可靠性，因此 TCP 的报文头 20 字节比 UDP 的报文头 8 字节大，所以 TCP 的【传输速度】没有 UDP 那么快。

|              | `TCP`                                 | `UDP`                                    |
| :----------- | :------------------------------------ | :--------------------------------------- |
| 可靠性       | 可靠                                  | 不可靠                                   |
| 连接性       | 面向连接                              | 无连接                                   |
| 报文         | 字节流                                | 报文                                     |
| 效率         | 传输效率低                            | 传输效率高                               |
| **`双工性`** | 全双工                                | 半双工（一对一、一对多、多对一、多对多） |
| 流量控制     | 滑动窗口                              | 无                                       |
| 拥塞控制     | 慢启动、拥塞避免`</br>`快重传、快恢复 | 无                                       |
| 传输速度     | 慢                                    | 快                                       |
| 应用场景     | 效率要求低、准确性要求高              | 效率要求高、准确性要求低                 |

- `连接性`

  - TCP 是面向连接(Connection oriented)的协议

  - UDP 是无连接(Connection less)协议

- `可靠性`

  - TCP 通过确认机制，丢包可以重发，保证数据的正确性;

  - UDP 不保证正确性，只是单纯的负责发送数据包；

- `有序性`

  - TCP 有序，消息在传输过程中可能会乱序，后发送的消息可能会先到达，TCP 会对其进行重排序

  - UDP 每次发送都是一个包，不会进行重排序

- `有界性`

  - TCP 无界，通过字节流传输，UDP 中每一个包都是单独的

  - UDP 有界；每一个包都是单独发送

- `拥塞控制`

  - TCP 有流量控制（拥塞控制），主要靠三次握手实现以及慢启动、拥塞避免、快重传、快恢复

  - UDP 没有这种可靠性的手段

- `传输速度`

  - TCP 传输慢，因为需要建立连接、保证可靠性和有序性，所以比较耗时

  - UPD 传输快，没有这些可靠性手段，，这就是为什么视频流、广播电视、在线多媒体游戏等选择使用 UDP

- `头部大小`

  - UDP 的头部，只有 8 个字节，传输开销小；可以携带更多的数据，也可以携带更细碎的数据，所以音视频一般都用`UDP`

  - TCP 头部的 20 个字节信息包的额外开销更大

- `应用场合`

  - TCP 一般应用在对可靠性要求比较高的场合，例如 http，ftp 等等

  - UDP 一般应用在对实时性要求较高场合，例如视频直播，大文件传输等等

## 怎么理解 `面向报文`、`面向字节流`

- `UDP` 面向报文

  就是应用层给多长报文，就传输多长的报文，即 `一次发送一个报文`。（所以一般会选择合适长度的报文来避免被分片）

- `TCP` 面向字节流

  应用层一次下发一个数据块到网络层，但是 `TCP` 把应用程序看成是一连窜的无结构的字节流，`TCP` 有个缓冲，当应用程序传送的数据块太长，`TCP` 就会把它划分短一些在传送。

- `TCP` 基于字节流，会产生 `粘包` 问题

- `UDP 用户数据包协议`

  UDP 是无连接的，尽最大可能交付，没有拥塞控制，面向报文（应用层给多长报文就传输多长报文，对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部）

- `TCP 传输控制协议`

  TCP 是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流（TCP 有缓冲区，窗口，会对上层传下来的数据做分组发送，或缓冲起来等到达一定量后一次发送），把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块

## UDP 如何实现可靠性传输

[[★ 如何用 UDP 实现可靠传输]]

> - 自己在应用层实现可靠机制
> - 换用修改过的开源 RUDP、RTP、UDT 等协议

- UDP 它不属于连接型协议，因而具有资源消耗小，处理速度快的优点，传输层无法保证数据的可靠传输，只能通过应用层来实现了。实现的方式可以参照 TCP 可靠性传输的方式，只是实现不在传输层，实现转移到了应用层

- `程序在应用层保证`

  - 添加`确认机制`，确保数据发送到对端

  - 添加发送和接收缓冲区

  - 添加`超时重传机制`

- 用 `开源的利用 UDP 实现可靠传输的协议`

# 参考资料
