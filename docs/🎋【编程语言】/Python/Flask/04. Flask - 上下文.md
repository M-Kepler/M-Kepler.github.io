- [参考资料](#参考资料)
- [★ 上下文](#-上下文)
  - [app_context, current_app, g 应用上下文](#app_context-current_app-g-应用上下文)
  - [request 和 session 请求上下文](#request-和-session-请求上下文)
- [其他](#其他)

# 参考资料

# ★ 上下文

- [Flask 中的请求上下文和应用上下文](https://zhuanlan.zhihu.com/p/26097310)

## app_context, current_app, g 应用上下文

- [Flask 的 g 对象](https://www.cnblogs.com/zhaoyunlong/p/10385540.html) 是一个全局的对象，这个对象存储的是我们`这一次请求`的所有的信息

- `g` 对象和 `session` 的区别

  - session 对象是可以跨 request 的，只要 session 还未失效，不同的 request 的请求会获取到同一个 session

  - g 对象不是，g 对象不需要管过期时间，请求一次就 g 对象就改变了一次，或者重新赋值了一次

## request 和 session 请求上下文

[Flask 基础之 session 原理详解](https://www.cnblogs.com/cwp-bg/p/10084523.html)

- 用户第一次请求后，将产生的状态信息保存在 `session` 中，这时可以把 `session` 当做一个容器，它保存了正在使用的所有用户的状态信息；这段状态信息分配了一个`唯一的标识符用来标识用户`的身份，将其保存在响应对象的 cookie 中；当第二次请求时，`解析cookie中的标识符，拿到标识符后去session找到对应的用户信息`

- 可以在不同的请求之间存储特定用户的信息，基于`cookies`进行密钥签名来实现的

- Flask 自带的 session `flask/sessions.py/SecureCookiesSessionInterface` 管理器默认将用户数据加密后存储在 `cookies` 中

  Flask 默认通过 SecureCookieSessionInterface 对象管理 session，其重写了 SessionInterface 对象的 open_session 方法和 save_session 方法，将用户的数据加密后存储在 cookie 中

  Flask 从 cookie（SESSION_COOKIE_NAME 参数有指定 cookie 的名称）中获取 session 信息

- `session` 例子

  ```py
  from flask import Flask, url_for, session
  app = Flask(__name__)
  # 用来对cookies计算签名
  app.secret_key = "hard to guess string"
  # app.config["SECRET_KEY"] = "hard to guess string"

  # 返回给客户端的cookies名称，默认是 session，放置在response的头部，也就是可以通过这个cookie来知道是谁发起的这个请求
  app.config['SESSION_COOKIE_NAME'] = 'session_huangjinjie'  # 设置session名字
  # app.session_cookie_name = "session_huangjinjie"

  @app.route('/index/')
  def index(nid):
      session["xxx"] = 123
      session["xxx2"] = 123
      del session["xxx"]
      return "hello"

  if __name__ == "__main__":
      app.run()
  ```

# 其他
