- [参考资料](#参考资料)
- [线程](#线程)
  - [★ 进程和线程的区别](#-进程和线程的区别)
  - [同一进程中的线程共享了哪些资源](#同一进程中的线程共享了哪些资源)
  - [同一进程下的多线程哪些东西是各自私有的](#同一进程下的多线程哪些东西是各自私有的)
  - [多线程进程 `fork` 出来的进程是单线程还是多线程](#多线程进程-fork-出来的进程是单线程还是多线程)
  - [线程有哪几种状态](#线程有哪几种状态)
  - [什么是线程的同步和互斥](#什么是线程的同步和互斥)
  - [★ 线程同步的方式有哪些](#-线程同步的方式有哪些)
  - [线程池的优点](#线程池的优点)

# 参考资料

# 线程

## ★ 进程和线程的区别

[线程和进程的区别](https://blog.csdn.net/lishenglong666/article/details/8557215)

> - `资源关系、【切换开销】、通信机制、数量关系`
> - 从 `CPU 调度`，`上下文切换`，`数据共享`，`多核CPU利用率`，`资源占用`，等等各方面回答
> - 然后有一个问题必须会被问到：`哪些东西是一个线程私有的`？答案中必须包含`寄存器`，否则悲催

**资源关系(数据和CPU)**

- 进程是资源分配的最小单位，线程是 CPU 调度的最小单位(拥有自己的栈空间)

**内存地址、地址空间**

- 进程在拥有`独立的内存单元`，而多个线程共享进程的地址空间

- 一个进程崩了不会对其他进程产生影响，而一个线程崩了，会导致整个进程都崩掉。

- 进程拥有自己的`独立地址空间`，每启动一个进程，系统都会为它分配 `0-4G(32位)` 的地址空间，建立数据表来维护 `代码段、地址段、数据段`

- 线程没有独立的地址空间，线程间使用相同的地址空间共享数据

**切换开销**

- `线程间彼此切换所需的时间也远远小于进程间切换所需要的时间`

- 启动一个新的进程必须分配给它独立的地址空间，建立众多的数据表来维护它的代码段、堆栈段和数据段，这是一种"昂贵"的多任务工作方式

- 一个进程中的多个线程之间使用相同的地址空间，共享大部分的数据，启动一个线程所花费的空间远远小于启动一个进程所花费的空间

- 每个进程都有独立的代码和数据空间（程序上下文），程序之间的切换会有较大的开销；线程可以看做轻量级的进程，同一类线程`共享代码和数据空间，每个线程都有自己独立的运行栈和程序计数器`，线程之间切换的开销小

**通信机制**

- 进程间通过 `IPC` 进行数据共享, 不仅耗时而且很不方便

- 线程是共用同一进程下的数据，更便捷（但是要注意多线程间锁的问题）

**数量关系**

- 一个程序至少有一个进程，一个进程至少有一个线程，线程依赖于进程而存在

**使用场景**

- 对资源的管理和保护要求高，不限制开销和效率时，使用多进程

- 要求效率高，`频繁切换`，资源的保护管理要求不是很高时，使用多线程

**CPU 调度**

- 进程是资源`分配`的最小单位，线程是程序执行的最小单位

- `切换/创建`一个线程的开销远比切换/创建一个进程小得多

- 线程占用的资源比进程少（进程 `PCB`）

**多进程程序更安全、更稳定**

- 一个进程挂掉不会对另一个进程产生影响（因为各自有独自的地址空间）

- 多线程程序更不易维护，一个线程挂掉，会导致整个进程挂掉（因为共享地址空间）

## 同一进程中的线程共享了哪些资源

> 结合前面 `系统为进程分配了什么资源` 一起看

- 进程`代码段`（代码和常量）

- 数据段（全局变量和静态变量、常量）

- 扩展段(堆存储)

- 打开的文件描述符（文件描述符表）

- 信号处理器（信号处理方式）

- 进程当前目录和进程用户 ID 已经进程组 ID

## 同一进程下的多线程哪些东西是各自私有的

`Linux` 下线程是以 `PCB process control block` 来模拟实现，所以线程其实是一个轻量级的进程，与同一进程中的线程共享该进程的 `大部分` 资源

- 线程 `ID`

- `寄存器`组的值

- 线程的栈

- 错误返回码

- 信号屏蔽字

## 多线程进程 `fork` 出来的进程是单线程还是多线程

[多线程进程 fork 出来的进程是单线程还是多线程](https://mp.weixin.qq.com/s/pgo47kDB2fhwc95vEXs_Fg)

`fork` 的时候会拷贝父进程的数据内容，即 `COW 写时复制`，但是已启动运行的线程，是不会被 `复制` 过去的。也就是说，从父进程 `fork` 出来的子进程，将会==是单线程的==。所以如果在 API 中需要启动工作线程，则工作线程需要在 `daemon` 化之后再启动

## 线程有哪几种状态

- [多线程—线程的 5 种状态](https://www.cnblogs.com/domi22/p/8046851.html)

- [C++之多线程学习篇（3）之线程状态](https://blog.csdn.net/Jacoob1024/article/details/81097721)

- `新建状态`

  新创建一个线程对象时的状态

- `就绪状态`

  参与调度，等待被执行（即其他资源已获取，`就差CPU`了），一旦被调度选中，立即开始执行

- `运行状态`

  获得 CPU，正在运行中

- `阻塞状态`

  因为某种原因`被迫交出CPU使用权`，暂时停止运行。直到线程进入就绪状态，才有机会转到运行状态。

- `终止状态`

  已经运行完毕，等待回收线程资源

## 什么是线程的同步和互斥

- 同步就是 `协同步调，按预定的先后次序进行运行`，不要理解成同时进行的意思，应是指协同、协助、互相配合

- 线程同步是指多线程通过特定的设置来 `控制线程之间的执行顺序（即所谓的同步）`也可以说是在线程之间通过同步建立起执行顺序的关系，如果没有同步，那线程之间是各自运行各自的

- `互斥指的是对于共享的进程资源，在各个单线程访问时的排他性`，线程互斥也可以看成一种特殊的同步

## ★ 线程同步的方式有哪些

[线程同步的四种方式](https://blog.csdn.net/guoxiang3538/article/details/79376191)

临界区、互斥量、信号量、事件对象

- `临界区`

  `通过多线程的串行化来访问公共资源或一段代码`，速度快，适合控制数据访问。任意时刻只有一个线程对共享资源进行访问

- `互斥量 mutex`

  和临界区很像，`只有拥有互斥量的线程才有访问公共资源的权限`，因为互斥量只有一个，所以能保证公共资源不会同时被对各线程访问到

- `信号量 semaphore`

  它允许多个线程在同一时刻访问同一资源，但是需要`限制在同一时刻访问此资源的最大线程数目`

- `事件 / 信号`

  通过`通知`操作的方式来保持线程的同步

## 线程池的优点

- `降低资源消耗`

  通过重复利用已创建的线程降低线程创建和销毁造成的消耗。

- `提高响应速度`

  当任务到达时，可以不需要等待线程创建就能立即执行。

- `提高线程的可管理性`

  线程是稀缺资源，如果无限制的创建，不仅会消耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，监控和调优
