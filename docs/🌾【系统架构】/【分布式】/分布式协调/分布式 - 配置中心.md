- [参考资料](#参考资料)
- [分布式注册服务中心 etcd](#分布式注册服务中心-etcd)
  - [需要解决什么问题](#需要解决什么问题)
  - [方案选型](#方案选型)
    - [ETCD](#etcd)
    - [Zookeeper](#zookeeper)
- [架构](#架构)
- [其他](#其他)

# 参考资料

# 分布式注册服务中心

注册中心简单来说，是为了解决分布式场景下，服务之间互相发现的问题。(**服务治理**)叫做分布式配置中心也可以的。

## 需要解决什么问题

![alt](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6fef563940424350bd2f089cdf87f42c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)

**这将面临如下问题需要解决：**

- 集群 A 中的服务调用者如何发现集群 B 中的服务提供者。

- 集群 A 中的服务调用者如何选择集群 B 中的某一台服务提供者机器发起调用。

- 集群 B 中的服务某台提供者机器下线后，集群 A 中的服务调用者如何感知到这台机器的下线，不再对已下线的机器发起调用。

- 集群 B 提供的某个服务如何获知集群 A 中的那些机器正在消费改服务。

以上问题都通过**注册中心**来解决，我们采用服务注册中心来实时存储更新服务提供者信息及该服务的实时调用者信息。

![iamge](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/657516506fd348c2b25bc4854b47fdc6~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)

**服务注册中心有如下优点：**

- 软负载及透明化路由：服务提供者和服务调用者之间互相解耦，服务调用者不需要硬编码服务提供者地址。

- 服务动态发现及可伸缩扩展能力：服务提供者机器增减能被服务调用者通过注册中心动态感知，而且通过增减机制可以实现服务的弹性伸缩。

- 通过注册中心可以动态监控服务运行质量及服务依赖，为服务提供服务治理能力。

## 方案选型

Zookeeper 是 Java 写的；etcd 是 go 写的

### ETCD

### Zookeeper

如何部署 Zookeeper 可以参考 [使用 Docker 一步搞定 ZooKeeper 集群的搭建](https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fkingkoo%2Fp%2F8732448.html)。

ZkClient 是一个开源的 ZooKeeper 客户端，是在原生的 ZooKeeper API 接口之上进行包装，是一个更易使用的 ZooKeeper 客户端。ZkClient 在内部实现了 Session 超时重连、Watcher 反复注册等功能，使得 ZooKeeper 客户端的繁琐细节对开发人员透明。如何使用可以参考 zookeeper 之 ZkClient。

**服务注册中心实现**

- 服务端服务启动时将服务提供者信息（主机 IP 地址、服务端口、服务接口类全限类名等）组成 znode 作为临时节点写入 Zookeeper 叶子节点，这样就完成了服务的注册动作。

- 服务的消费端在发起服务调用之前，先连接到 Zookeeper，对服务提供者节点路径注册监听器，同时获取服务提供者信息到本地缓存。

- 服务注册中心能够感知服务提供者集群中某一台机器下线，将该机器服务提供者信息从服务注册中心删除，并主动通知服务调用者集群中的每一台机器，使得服务调用者不再调用该机器。

- 可以通过服务注册中心收集服务消费者信息。

# 架构

# 其他
