- [服务器集群之后需要解决什么问题](#服务器集群之后需要解决什么问题)
  - [负载均衡](#负载均衡)
  - [消息队列](#消息队列)
  - [限流](#限流)
  - [分布式系统间的协调](#分布式系统间的协调)
  - [分布式系统中的选举机制（选主）](#分布式系统中的选举机制选主)
  - [分布式系统中的容错机制（节点动态伸缩）](#分布式系统中的容错机制节点动态伸缩)
  - [分布式 session 一致性](#分布式-session-一致性)
  - [分布式锁](#分布式锁)
  - [分布式全局唯一 ID](#分布式全局唯一-id)
  - [分布式事务](#分布式事务)
  - [分布式中接口顺序性](#分布式中接口顺序性)
  - [分布式中接口幂等性](#分布式中接口幂等性)
  - [分布式配置中心](#分布式配置中心)
  - [分布式任务调度平台](#分布式任务调度平台)
  - [分布式日志收集问题](#分布式日志收集问题)
- [分布式中间件都会遇到的问题](#分布式中间件都会遇到的问题)
  - [节点通信问题](#节点通信问题)
  - [节点选举问题](#节点选举问题)
  - [一致性算法](#一致性算法)
- [其他](#其他)

# 服务器集群之后需要解决什么问题

## 负载均衡

- 实现方式

  - 硬件负载均衡

  - ip 负载均衡

  - dns 负载

  - http 重定向

  - 反向代理

- 负载均衡策略

  - 轮询

  - 加权轮询

  - 源地址哈希

  - 目的地址哈希

  - 一致性哈希算法

## 消息队列

- 接口幂等性

- 接口顺序性

## 限流

- 计数器

- 滑动窗口

- 漏桶

- 令牌桶

## 分布式系统间的协调

- zookeeper

- etcd

## 分布式系统中的选举机制（选主）

zookeeper kafka mysql redis

## 分布式系统中的容错机制（节点动态伸缩）

## 分布式 session 一致性

> 因为 session 存放在服务器端，sesionid 找不到对应的 sesion

- cookie 代替

  - cookie 有大小限制

  - 需要客户端开启 cookie

  - 每次请求都携带 cookie 影响性能

- 用 token 代替

- 部署 session 服务器集群

## 分布式锁

- 采用数据库乐观锁

  不建议，性能不

- 基于 Redis 实现分布式锁 (`setnx`)

  不推荐，容易产生死锁现象，代码复杂

- 基于 Zookeeper 实现分布式锁

  Zookeeper 是分布式协调工具，在分布式解决方案中使用。基于 zookeeper 使用临时节点 + 事件通知

- 开源框架 `Redission`

  分布式锁可能存在锁过期释放，业务没执行完的问题

## 分布式全局唯一 ID

- MySQL 设置步长

- Redis 的 INCR 和 INCRBY

- 雪花算法

## 分布式事务

> 与集群没有关系

柔性事务

- lck 框架

- 消息中间件 base 理论 柔性事务

## 分布式中接口顺序性

> 业务上应该尽量避免

- 一致性哈希 + 内存队列

  尽可能把请求打到一台机器上

## 分布式中接口幂等性

---

## 分布式配置中心

与集群没有关系

- SpringCloud 中的 config

- 携程 apollo 框架

## 分布式任务调度平台

服务器集群之后如何保证定时 job 唯一性问题、幂等性

xxl-job 框架

## 分布式日志收集问题

如果有服务有 20 台做集群，查询日志的话非常麻烦

- elk

- kafka

# 分布式中间件都会遇到的问题

## 节点通信问题

## 节点选举问题

## 一致性算法

poxos gosip raft kraft

# 其他

epoch 纪元（翻译成轮次贴切点）

分这么多服务，不同服务还部署再不同服务器上，那岂不是增加了通信成本了？

比如，在同一个进程内，你对一个方法的调用如果成功，那就是成功 (当然，如果你的代码有 bug 那就另说了)，如果调用失败，比如抛出异常那就是调用失败。在同一个进程内，如果这个方法先调用先执行，那就是先执行。

但是在分布式环境中呢？ 由于网络的不可靠，你对一个服务的调用失败了并不表示一定是失败的，可能是执行成功了，但是响应返回的时候失败了。

还有，A 和 B 都去调用 C 服务，在时间上 A 还先调用一些，B 后调用，那么最后的结果是不是一定 A 的请求就先于 B 到达呢？

这些本来在同一个进程内的种种假设我们都要重新思考，我们还要思考这些问题给我们的设计和编码带来了哪些影响。还有，在分布式环境中为了提升可靠性，我们往往会部署多套服务，但是如何在多套服务中达到一致性，这在同一个进程内很容易解决的问题，但在分布式环境中确实一个大难题。

MySQL 对分布式支持不佳，若后续单库存在性能瓶颈，需要进行横向扩展时，则需引入第三方组件进行分库管理，存在风险运维和数据一致性等方面的风险

客户端不需要连接集群所有节点, 连接集群中任何一个可用节点即可。
